<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dental Services | Shine Smile</title>
    <link rel="stylesheet" href="./assets/css/reset.css" />
    <link rel="stylesheet" href="./assets/css/style.css" />
  </head>
  <body class="header">
    <section class="service" style="padding: 0">
      <div class="container">
        <div class="header-top">
          <a href="./"
            ><img
              src="./assets/img/logo.svg"
              alt="shine smile"
              class="logo header__logo"
          /></a>
          <nav class="navbar">
            <ul class="navbar__list" id="navbar__list--pc">
              <li class="navbar__item">
                <a href="./index.html" class="navbar__link navbar__link--active"
                  >Home</a
                >
              </li>
              <li class="navbar__item">
                <a href="./services.html" class="navbar__link">Services</a>
              </li>
              <li class="navbar__item">
                <a href="#!" class="navbar__link">About</a>
              </li>
              <li class="navbar__item">
                <a href="#!" class="navbar__link">Doctors</a>
              </li>
            </ul>
          </nav>
          <div class="header__action">
            <span
              id="userInfo"
              style="color: #10375c; margin-right: 20px; display: none"
            ></span>
            <a
              href="./dashboard.html"
              id="dashboardLink"
              class="header__action--login"
              style="display: none"
              >Dashboard</a
            >
            <a href="./login.html" id="loginLink" class="header__action--login"
              >Log In</a
            >
            <a
              href="./register.html"
              id="registerLink"
              class="btn header__action--sign-up"
              >Sign Up</a
            >
            <button
              id="logoutBtn"
              class="header__action--login"
              style="
                display: none;
                background: none;
                border: none;
                cursor: pointer;
              "
            >
              Logout
            </button>
          </div>
        </div>
        <h2
          class="service__heading section-heading"
          style="color: #ccc; padding-top: 40px"
        >
          Dental Services
        </h2>
        <p class="section-desc service__desc">
          Select the service you need and book an appointment quickly
        </p>
        <div class="service__row">
          <div class="service-item">
            <div class="service-item__icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="22"
                height="24"
                viewBox="0 0 22 24"
                fill="none"
              >
                <path
                  d="M20.3598 2.63964C17.9506 -0.556131 14.2772 -0.568132 11.2481 1.10682C11.001 1.24657 10.7219 1.31411 10.4406 1.30222C10.1592 1.29033 9.88633 1.19945 9.65105 1.03931C8.49552 0.245717 7.29036 -0.316477 5.13904 0.207462C0.623408 1.3071 0 4.90379 0 8.99816C0.0797353 12.1602 0.500857 15.3032 1.25551 18.3683C2.11836 22.0168 3.90382 24 5.43354 24C6.96326 24 7.00963 22.2204 7.00963 20.8016C7.00963 19.2009 7.39505 14.8009 10.8642 14.8009C13.5317 14.8009 14.3333 18.4013 14.3333 20.8016C14.3329 23.095 15.1722 24 16.6628 24C19.5267 24 20.9796 15.3938 21.3719 13.1237C21.7642 10.8535 22.9882 6.12569 20.3598 2.63964Z"
                  fill="currentColor"
                />
              </svg>
            </div>
            <div>
              <h3 class="service-item__heading">Teeth Cleaning</h3>
              <p class="service-item__desc">
                Remove plaque and brighten your teeth.
              </p>
            </div>
          </div>
          <div class="service-item">
            <div class="service-item__icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="22"
                height="24"
                viewBox="0 0 22 24"
                fill="none"
              >
                <path
                  d="M20.3598 2.63964C17.9506 -0.556131 14.2772 -0.568132 11.2481 1.10682C11.001 1.24657 10.7219 1.31411 10.4406 1.30222C10.1592 1.29033 9.88633 1.19945 9.65105 1.03931C8.49552 0.245717 7.29036 -0.316477 5.13904 0.207462C0.623408 1.3071 0 4.90379 0 8.99816C0.0797353 12.1602 0.500857 15.3032 1.25551 18.3683C2.11836 22.0168 3.90382 24 5.43354 24C6.96326 24 7.00963 22.2204 7.00963 20.8016C7.00963 19.2009 7.39505 14.8009 10.8642 14.8009C13.5317 14.8009 14.3333 18.4013 14.3333 20.8016C14.3329 23.095 15.1722 24 16.6628 24C19.5267 24 20.9796 15.3938 21.3719 13.1237C21.7642 10.8535 22.9882 6.12569 20.3598 2.63964Z"
                  fill="currentColor"
                />
              </svg>
            </div>
            <div>
              <h3 class="service-item__heading">Braces</h3>
              <p class="service-item__desc">
                Align your teeth for a better smile.
              </p>
            </div>
          </div>
        </div>
        <div class="service__row" style="margin-top: 30px">
          <div class="service-item">
            <div class="service-item__icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="22"
                height="24"
                viewBox="0 0 22 24"
                fill="none"
              >
                <path
                  d="M20.3598 2.63964C17.9506 -0.556131 14.2772 -0.568132 11.2481 1.10682C11.001 1.24657 10.7219 1.31411 10.4406 1.30222C10.1592 1.29033 9.88633 1.19945 9.65105 1.03931C8.49552 0.245717 7.29036 -0.316477 5.13904 0.207462C0.623408 1.3071 0 4.90379 0 8.99816C0.0797353 12.1602 0.500857 15.3032 1.25551 18.3683C2.11836 22.0168 3.90382 24 5.43354 24C6.96326 24 7.00963 22.2204 7.00963 20.8016C7.00963 19.2009 7.39505 14.8009 10.8642 14.8009C13.5317 14.8009 14.3333 18.4013 14.3333 20.8016C14.3329 23.095 15.1722 24 16.6628 24C19.5267 24 20.9796 15.3938 21.3719 13.1237C21.7642 10.8535 22.9882 6.12569 20.3598 2.63964Z"
                  fill="currentColor"
                />
              </svg>
            </div>
            <div>
              <h3 class="service-item__heading">Teeth Whitening</h3>
              <p class="service-item__desc">
                Professional whitening for brighter teeth.
              </p>
            </div>
          </div>
          <div class="service-item">
            <div class="service-item__icon">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="22"
                height="24"
                viewBox="0 0 22 24"
                fill="none"
              >
                <path
                  d="M20.3598 2.63964C17.9506 -0.556131 14.2772 -0.568132 11.2481 1.10682C11.001 1.24657 10.7219 1.31411 10.4406 1.30222C10.1592 1.29033 9.88633 1.19945 9.65105 1.03931C8.49552 0.245717 7.29036 -0.316477 5.13904 0.207462C0.623408 1.3071 0 4.90379 0 8.99816C0.0797353 12.1602 0.500857 15.3032 1.25551 18.3683C2.11836 22.0168 3.90382 24 5.43354 24C6.96326 24 7.00963 22.2204 7.00963 20.8016C7.00963 19.2009 7.39505 14.8009 10.8642 14.8009C13.5317 14.8009 14.3333 18.4013 14.3333 20.8016C14.3329 23.095 15.1722 24 16.6628 24C19.5267 24 20.9796 15.3938 21.3719 13.1237C21.7642 10.8535 22.9882 6.12569 20.3598 2.63964Z"
                  fill="currentColor"
                />
              </svg>
            </div>
            <div>
              <h3 class="service-item__heading">Dental Implants</h3>
              <p class="service-item__desc">
                Restore missing teeth with durable implants.
              </p>
            </div>
          </div>
        </div>
        <form
          id="appointmentForm"
          style="
            background: #eaf6ff;
            padding: 40px;
            border-radius: 10px;
            margin-top: 60px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
          "
        >
          <h2
            class="section-heading"
            style="font-size: 3rem; text-align: center"
          >
            Book Appointment
          </h2>
          <div
            id="loginMessage"
            style="
              display: none;
              background: #ffebee;
              color: #c62828;
              padding: 10px;
              border-radius: 5px;
              margin-bottom: 20px;
              text-align: center;
            "
          >
            Please <a href="./login.html" style="color: #2e80ce">login</a> to
            book an appointment
          </div>
          <input
            type="text"
            id="fullName"
            placeholder="Full Name"
            required
            style="
              margin-top: 20px;
              width: 100%;
              padding: 10px;
              border: 1px solid #ccc;
              border-radius: 6px;
            "
          />
          <input
            type="email"
            id="email"
            placeholder="Email"
            required
            style="
              margin-top: 20px;
              width: 100%;
              padding: 10px;
              border: 1px solid #ccc;
              border-radius: 6px;
            "
          />
          <input
            type="tel"
            id="phone"
            placeholder="Phone Number"
            required
            style="
              margin-top: 20px;
              width: 100%;
              padding: 10px;
              border: 1px solid #ccc;
              border-radius: 6px;
            "
          />
          <select
            id="service"
            required
            style="
              margin-top: 20px;
              width: 100%;
              padding: 10px;
              border: 1px solid #ccc;
              border-radius: 6px;
            "
          >
            <option value="">Select a service</option>
            <option value="cleaning">Teeth Cleaning</option>
            <option value="whitening">Teeth Whitening</option>
            <option value="braces">Braces</option>
            <option value="implants">Dental Implants</option>
          </select>
          <input
            type="date"
            id="appointmentDate"
            required
            style="
              margin-top: 20px;
              width: 100%;
              padding: 10px;
              border: 1px solid #ccc;
              border-radius: 6px;
            "
          />
          <select
            id="timeSlot"
            required
            style="
              margin-top: 20px;
              width: 100%;
              padding: 10px;
              border: 1px solid #ccc;
              border-radius: 6px;
            "
          >
            <option value="">Select Time Slot</option>
            <option value="09:00 AM">09:00 AM</option>
            <option value="09:30 AM">09:30 AM</option>
            <option value="10:00 AM">10:00 AM</option>
            <option value="10:30 AM">10:30 AM</option>
            <option value="11:00 AM">11:00 AM</option>
            <option value="11:30 AM">11:30 AM</option>
            <option value="02:00 PM">02:00 PM</option>
            <option value="02:30 PM">02:30 PM</option>
            <option value="03:00 PM">03:00 PM</option>
            <option value="03:30 PM">03:30 PM</option>
            <option value="04:00 PM">04:00 PM</option>
            <option value="04:30 PM">04:30 PM</option>
          </select>
          <textarea
            id="notes"
            placeholder="Additional notes (optional)"
            style="
              margin-top: 20px;
              width: 100%;
              padding: 10px;
              border: 1px solid #ccc;
              border-radius: 6px;
              min-height: 80px;
              resize: vertical;
            "
          ></textarea>
          <button
            type="submit"
            class="btn"
            style="margin-top: 30px; width: 100%"
          >
            Confirm Booking
          </button>
          <div
            id="message"
            style="
              margin-top: 20px;
              padding: 10px;
              border-radius: 5px;
              text-align: center;
              display: none;
            "
          ></div>
        </form>
      </div>
    </section>

    <script>
      // Check if user is logged in
      const token = localStorage.getItem("token");
      const user = JSON.parse(localStorage.getItem("user") || "{}");
      const loginMessage = document.getElementById("loginMessage");
      const appointmentForm = document.getElementById("appointmentForm");
      const messageDiv = document.getElementById("message");
      const userInfo = document.getElementById("userInfo");
      const dashboardLink = document.getElementById("dashboardLink");
      const loginLink = document.getElementById("loginLink");
      const registerLink = document.getElementById("registerLink");
      const logoutBtn = document.getElementById("logoutBtn");

      if (!token) {
        loginMessage.style.display = "block";
        appointmentForm.style.display = "none";
      } else {
        // Update navigation for logged-in user
        userInfo.textContent = `Welcome, ${
          user.fullName || user.username || "User"
        }`;
        userInfo.style.display = "inline";
        dashboardLink.style.display = "inline";
        loginLink.style.display = "none";
        registerLink.style.display = "none";
        logoutBtn.style.display = "inline";

        // Logout functionality
        logoutBtn.addEventListener("click", () => {
          localStorage.removeItem("token");
          localStorage.removeItem("user");
          window.location.reload();
        });
      }

      // Set minimum date to today
      const dateInput = document.getElementById("appointmentDate");
      const today = new Date().toISOString().split("T")[0];
      dateInput.min = today;

      // Handle form submission
      appointmentForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        const formData = {
          fullName: document.getElementById("fullName").value,
          email: document.getElementById("email").value,
          phone: document.getElementById("phone").value,
          service: document.getElementById("service").value,
          appointmentDate: document.getElementById("appointmentDate").value,
          timeSlot: document.getElementById("timeSlot").value,
          notes: document.getElementById("notes").value,
        };

        try {
          const response = await fetch(
            "http://localhost:5000/api/appointments/book",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${token}`,
              },
              body: JSON.stringify(formData),
            }
          );

          const data = await response.json();

          if (response.ok) {
            showMessage("Appointment booked successfully!", "success");
            appointmentForm.reset();
          } else {
            showMessage(data.message || "Failed to book appointment", "error");
          }
        } catch (error) {
          console.error("Error:", error);
          showMessage("Network error. Please try again.", "error");
        }
      });

      function showMessage(message, type) {
        messageDiv.textContent = message;
        messageDiv.style.display = "block";
        messageDiv.style.backgroundColor =
          type === "success" ? "#e8f5e8" : "#ffebee";
        messageDiv.style.color = type === "success" ? "#2e7d32" : "#c62828";

        setTimeout(() => {
          messageDiv.style.display = "none";
        }, 5000);
      }
    </script>
  </body>
</html>
